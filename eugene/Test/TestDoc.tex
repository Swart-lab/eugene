\documentclass[a4paper,11pt]{article}

\usepackage[pdftex]{graphicx}
\usepackage{times}

\newcommand{\EuGenie}{\textsc{EuG{\`e}ne}}


\begin{document}
\setlength{\parindent}{0pt}

\title{Project \EuGenie: Tests description}
\maketitle

\section{Implemented tests}

\subsection{Units tests}
Units tests test separately each sensor. For each sensor, Eugene is executed using only the sensor (except for Est that requires also NG2, and for IfElse that requires NG2 and SPred), the detailed text output (generated by the -pd argument) is compared with a diff command (file is too long to use the spawn command) to a reference file.
A small file of araset is used for the test: seq14ac002535g4g5.tfa (8 Kb). \\ 
GFF3 units tests test some sensors when the GFF3 format parameter is activated. \\ \\
In the eugene/Test/config/TestVar.tcl file, the AllSensorsList variable contains the list of sensors to test, and the AllGff3Sensors variable contains the list of sensors to test with the activated GFF3 format parameter.\\
The Units tests are implemented in the eugene/Test/TestSuite/Units.exp file and the GFF3 units tests in eugene/Test/TestSuite/UnitsGff3.exp.\\

\subsection{Functional tests}
Functional tests test valid groups of sensors. Five tests described below are performed. \\
The textual output (except the 2 first lines due to version reference in them) and the generated graph are compared with a diff command to reference files. The list of the functional tests is included in the FunctionalTestList variable, in the eugene/Test/config/TestVar.tcl file. \\ 
Functional tests are implemented in the eugene/Test/TestSuite/Functionals.exp file. \\ 

\begin{center}
\begin{tabular}{|c|c|c|c|c|c|} \hline \hline
{\bf Functional Tests}& {\bf SeqAra}& {\bf SeqHom}& {\bf SeqDoc}& {\bf SeqRest}& {\bf SeqAlt}\\ \hline \hline

{\bf Sequences}& & & & & \\ \hline \hline
seq25ab005234g10g.tfa    & x &   &   & x &    \\
(15 Kb) (araset)         &   &   &   &   &    \\ \hline 
exSeqHom.fasta (3 Kb)    &   & x &   &   &     \\ 
(EugeneHom)              &   &   &   &   &    \\ \hline 
SYNO\_ARATH.fasta (4 Kb) &   &   & x &   &     \\ 
(documentation)          &   &   &   &   &    \\ \hline 
 At5g18830.fasta         &   &   &   &   & x  \\ \hline \hline 

{\bf Sensors}& & & & \\ \hline \hline
MarkovIMM      &       x        &         &       x     &      x         &  x   \\ \hline
MarkovConst    &       x        &     x   &       x     &                &  x   \\ \hline
MarkovProt     &                &     x   &             &                &      \\ \hline
EuStop         &       x        &     x   &       x     &      x         &  x   \\ \hline
NStart         &       x        &         &       x     &                &  x   \\ \hline
PatConst       &                &         &             &      x         &      \\ \hline
StartWAM       &                &     x   &             &                &      \\ \hline
NG2            & *              &         & *           & *              &  x   \\  \hline
SPred          & *              &         & *           & *              &  x   \\  \hline
GSplicer       &       x        &         &             &                &      \\ \hline
SpliceWAM      &                &     x   &             &                &      \\ \hline
Est            &       x        &         &             &                &  x   \\  \hline
Riken          &                &         &             &      x         &      \\ \hline
BlastX         &       x        &         &             &                &      \\  \hline
Homology       &                &     x   &             &                &      \\ \hline
FrameShift     &                &         &      x      &                &      \\ \hline
Transcript     &                &     x   &      x      &                &      \\ \hline
Repeat         &                &         &             &      x         &      \\ \hline
GFF            &                &     x   &             &                &      \\ \hline
IfElse         &       x        &         &      x      &      x         & x    \\ \hline \hline

{\bf Arguments}& & & & & \\ \hline \hline
a              &                &         &             &                & x    \\ \hline 
g              &       x        &     x   &      x      &      x         & x    \\ \hline
\end{tabular}
\end{center}
(*)Used by IfElse
\vspace{0.5cm}

\subsection{Arabidopsis tests}
Two tests are performed on Arabidopsis sequences, just checking the stdout outputs:\\
The Araset test checks the Eugene predictions, performed on all the sequences of the set /Annotation/Arabidopsis/araset/Genes, using the MarkovIMM, MarkovConst, EuStop, NStart, IfElse, GSplicer, Est, BlastX and Transcript sensors.\\
The Big test checks the Eugene predictions performed on the chr1\_2002.tfa\_225400
00-23040000.tfa (508 Kb) file, using the MarkovIMM, Transcript, MarkovConst, EuStop, NStart, GSplicer, Est and BlastX sensors.\\
A third test is performed: the ArasetSpSn test, checking the specificity and the sensibility of the araset eugene results.\\
The list of the Arabidopsis tests is included in the ArabidopsisTestList variable, in the eugene/Test/config/TestVar.tcl file. These tests are implemented in the eugene/Test/TestSuite/Arabidopsis.exp file.\\ 

\section{How to run tests}

Define EUGENEDIR environment variable: \\
{\tt \small setenv EUGENEDIR /eugene/path} (under csh) or \\
{\tt \small export EUGENEDIR=/eugene/path} (under sh/bash) \\

The 'check' target of Makefile launchs all the tests: {\tt \small make check}.\\
To perform only some tests, use the Makefile TEST variable.
For example, to specify only 2 tests, type: \\
{\tt \small make check TEST='Units.exp Functionals.exp'} \\
or to ignore a test, type: \\
{\tt \small make check TEST='--ignore ``Units.exp'''}\\
\\
When a test fails, examine the differences between the reference file (in eugene/Test
/Outputs directory) and the file generated during the test (in eugene/Test/TestTrace directory).
For example, if the EuStop test fails, type: \\
{\tt \small tkdiff -i Test/Outputs/Output\_EuStop Test/TestTrace/Output\_EuStop}\\
The -i argument allows to ignore case letter difference (see last section that details Linux and SUN OS difference).

\section{Test software sources organization}
All the test files are located in the eugene/Test directory, composed of 5 subdirectories:
\begin{itemize}
\item {\bf Sequences}: contains all the sequences and the related information,
\item {\bf Outputs}: contains all the generated reference files,
\item {\bf config} (name imposed by DejaGnu): contains the scripts to generate reference files (GenerateOutputs.tcl), to define common procedures and variables (*.tcl), for Dejagnu runtest initialization (default.exp),
\item {\bf TestSuite}: contains the tests scripts (written in Expect language),
\item {\bf TestTrace}: contains the DejaGnu test traces (files .sum and .log) and the files generated by failing tests.
\end{itemize}

\section{How to add other tests}
\begin{enumerate}
 \item  Put test data in the directory eugene/Test/Sequences
 \item Define the test variables in eugene/Test/config/TestVar.tcl
\begin{itemize}
 \item To add a sensor unit test:\\
Add the sensor name in the both variables \textit{AllSensorsList} and \\ 
\textit{AllGff3Sensors}.
\item To add a functional test:\\
Add the test name to the variable \textit{FunctionalTestList} and
initialize the variables indexed with the test name. Example with the test \textit{SeqAra}:\\
{\tt \small set SensorsList(SeqAra) \{MarkovIMM EuStop NStart\}\\
 set SEQ(SeqAra) \{seq25ab005234g10g11.tfa\}\\
 set FILE\_REF(SeqAra) Output\_seqAra\\
 set OPTIONS(SeqAra) "-po -g"}
\item To add an other test:\\
Define required variables. Example to create the test \textit{ArasetSpSn} executing the command 
\textit{eugene/Proc/Eval/egn\_evalpred.pl \\Â /Annot/araset.coord Test/Outputs/Output\_Araset}: \\
{\tt \small set FILE\_REF(ArasetSpSn) Output\_Araset\_SpSn \\
set FILE\_COORD(ArasetSpSn) \"/Annot/araset.coord\" \\
set PRG\_EVAL\_PRED eugene/Proc/Eval/egn\_evalpred.pl }

\end{itemize}
\item If new eugene parameters was created, Initalize them in the method  \textit{InitParameterFile} of the script eugene/Test/config/TestProc.tcl. Example:\\
{\tt \small \#\#\#\# NewSensor parameters \#\#\#\# \\
set NewValue1(NewSensor.param1)  10\\
set NewValue1(NewSensor.param2)  87 }
\item Case it's not a simple unit or functional test:\\
In eugene/test/TestSuite, write the test by adapting an existing .exp file or by creating a new one. Example  of modification in Arabidopsis.exp to integrate the test \textit{ArasetSpSn}:\\
{\tt \small
   if \{\$TEST == "Araset"\} \{ \\
       set TEST2 "ArasetSpSn" \\
       eval exec \$PRG\_EVAL\_PRED \$FILE\_COORD(\$TEST2) tmp\%stdout >\& \\ 
	\$TRACE\_DIR/\$FILE\_REF(\$TEST2) \\
       RemoveFirstLines \$TRACE\_DIR/\$FILE\_REF(\$TEST2) \\
       set test\_spsn [diff \$OUTPUT\_DIR/\$FILE\_REF(\$TEST2) \\
	\$TRACE\_DIR/\$FILE\_REF(\$TEST2)]\\
       if \{\$test\_spsn != 1\} \{ \\
           fail "\$\{TEST\} (spsn)" \\
          \} else \{ \\
           catch \{ exec rm \$TRACE\_DIR/\$FILE\_REF(\$TEST2)\}\\
       \}\\
   \} 	
}

Then modify eugene/Test/config/GenerateOutputs.tcl to generate the test reference file. 
Note that the way to generate the test reference file and the test output file has to be similar
because this two files are compared to evaluate the success of the test.
\item Run eugene/Test/config/GenerateOutputs.tcl to build the reference files in the directory eugene/Test/Outputs.
\end{enumerate}

\section{Notes}
In July 2003, some differences exist between Linux (debian 3.0, gcc 2.95.4) and SUN OS (solaris 2.9, gcc 2.8.1). \\
\\
With SUN OS:
\begin{itemize}
\item options must be specified before sequences,
\item a name must be specified after the -g argument,
\item Inf is written instead of inf, diff is then used with the -i argument to ignore the case of letter,
\item optimal path value may be a little different (for MarkovProt test after the 4th decimal digit), the display of optimal path has been limited to 4 decimal digits.
\end{itemize}

In September 2004, some test results are different depending on the used g++ compiler.\\
Output\_BlastX have a false 5130 line with g++ 2.95 and a true one with g++ 3.3 and higher.\\
In Output\_AraSeq, the value of the optimum path is slightly different with those 2 compilers.\\
\\
Due to the complete autoconfiscation of the software and the preparation of the diffusion as a debian package, the root of files is named eugene instead of EuGeneTk, the executable is called eugene instead of EuGeneAS, and it is no more necessary to create a EuGeneTest.par file to test the software.\\


\end{document}




